# Онлайн-пазл «Карта субъектов Российской Федерации»

Интерактивная игра для семинаров по ГМУ: студент перетаскивает субъекты РФ на карту, один за другим, и собирает полную карту из 89 регионов. Встроены таймер, «лоток» текущей детали, три уровня сложности, таблицы лидеров по сложности, экспорт результатов в CSV, сохранение ФИО/номера группы и результатов в Firebase Realtime Database.

**Демо:** https://arseniy24rus.github.io/Russian-regions-puzzle/

---

## Возможности

- Перетаскивание «одной детали за раз» из лотка внизу.
- Плавный пан/зум; на мобильных — пинч-зум двумя пальцами.
- Три сложности: **Лёгкая**, **Средняя**, **Высокая** (сила «магнита» привязки).
- Блокировка сложности после установки первой детали.
- Подсчёт времени (ограничение 59:59), салют и фанфары по завершении.
- Таблицы лидеров отдельно по каждой сложности; фильтр по номеру группы.
- Экспорт **всех** результатов в CSV (для выставления баллов).
- Автосохранение ФИО/группы/сложности в `localStorage`.

---

## Технологический стек

- Чистый **HTML5 + Canvas** (без сборки).
- **D3** (проекция/геометрия), **topojson-client**.
- **Firebase Realtime Database** (через CDN, compat API).
- **TopoJSON** с 89 субъектами РФ.

---

## Структура репозитория

```
/
├─ index.html                          # Вся логика и интерфейс
└─ Russian_regions_TopoJSON.topojson   # Геоданные субъектов РФ (89 объектов)
```

> Важно: файл TopoJSON должен называться **ровно** `Russian_regions_TopoJSON.topojson` и лежать рядом с `index.html` (в корне). Имя и путь «зашиты» в коде.

---

## Быстрый старт (локально)

1. Скачайте репозиторий (или ZIP и распакуйте).
2. Откройте `index.html` в браузере.  
   Если браузер блокирует `fetch` локального файла, поднимите простой сервер:
   - Python 3:
     ```bash
     python -m http.server 8000
     ```
     и откройте http://localhost:8000/
3. Убедитесь, что карта загружается и лоток виден внизу.

> Для сохранения результатов в таблицу лидеров требуется интернет (Firebase и CDN-бандлы).

---

## Публикация на GitHub Pages

1. В настройках репозитория включите **Pages** → **Deploy from branch** → ветка `main` → `/root`.
2. Дождитесь сборки; ваш сайт будет доступен по адресу вида:  
   `https://<ваш_логин>.github.io/<имя_репозитория>/`.

---

## Настройка Firebase (для своего проекта)

В `index.html` блок:

```html
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "...",
    authDomain: "...",
    projectId: "...",
    storageBucket: "...",
    messagingSenderId: "...",
    appId: "...",
    measurementId: "...",
    databaseURL: "https://<your-db>.firebaseio.com/"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>
```

Замените значения на свои из консоли Firebase (включая `databaseURL`).

**Минимальные правила безопасности** (разрешить только создание записей и чтение, без прав на изменение/удаление чужих попыток):

```json
{
  "rules": {
    ".read": true,
    "results": {
      ".read": true,
      "$pushId": {
        ".write": "!data.exists()"
      }
    }
  }
}
```

> Поле `results` хранит объекты вида:  
> `{ fio, group, difficulty, time_ms, placed, total, timestamp, user_agent }`.

---

## Как провести занятие

1. Раздайте студентам QR-код на GitHub Pages.
2. Каждый вводит **ФИО** и **номер группы** (пример: `ГГУБД-01-25`), выбирает сложность.
3. После установки первой детали выбранная сложность **блокируется**.
4. По завершении пазла (89/89) запускается салют, время фиксируется и результат автоматически попадает в базу.
5. Преподаватель внизу страницы видит **три таблицы лидеров** (по сложностям) и может отфильтровать по группе.  
   Кнопка «Скачать CSV» выгружает **все** попытки за период.

---

## Управление

- **Перетаскивание детали:** из лотка вверх на карту.
- **Масштаб:** колесо мыши / пинч-зум двумя пальцами.
- **Перемещение карты:** перетаскивание фона одним пальцем/мышью.
- **Вернуть деталь:** если потерялась, возвращает текущую в лоток.
- **Центрировать карту:** сброс вида к исходному.

---

## Кастомизация

- **Сложности и «магнит»:** в `index.html`, функция `snapRadiusBy()`:
  ```js
  function snapRadiusBy(diff){ return diff==='easy'?60:(diff==='medium'?30:12); }
  ```
  Можно усилить/ослабить «притяжение».

- **Цвета:** синий для установленных (`#00AEEF`) плавно меняется до красного при финише.  
  Изменяется в массиве цветов `BLUE`/`RED`.

- **Подпись на странице:** внизу файла `<div class="footer">…</div>`.

---

## Экспорт данных

Кнопка **«Скачать CSV (все результаты)»** выгружает сырой набор записей:
```
fio,group,difficulty,time_mmss,time_ms,timestamp_iso,user_agent
```
Для выставления оценок используйте фильтр по группе и/или сортировку по времени.

---

## FAQ / типичные проблемы

**Висит «Загрузка карты…»**  
Проверьте, что рядом с `index.html` лежит файл **`Russian_regions_TopoJSON.topojson`** и имя совпадает. На GitHub Pages очистите кэш (в URL у нас уже стоит `?v=…`).

**Локально не грузится TopoJSON**  
Откройте через простой HTTP-сервер (`python -m http.server`) вместо `file://`.

**Firebase пишет ошибку доступа**  
Проверьте `databaseURL` и правила безопасности. Если включили строгие правила, убедитесь, что разрешено `push` в `/results`.

**Тормозит на мобильных**  
Закройте другие вкладки, уменьшите масштаб до видимой области, обновите браузер. Приложение использует Canvas без тяжелых библиотек и работает в современных браузерах.

---

## Автор и лицензия

Автор: **Ситковский Арсений Михайлович**  
Контакты: `omnistat@yandex.ru`  
Год: **2025**
